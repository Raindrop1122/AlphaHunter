<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alpha Hunter // Quant Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;800&family=Rajdhani:wght@300;500;600;700&family=Inter:wght@300;400;600&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root {
            /* Dark Mode (Default) */
            --primary: #00f2ea;           
            --primary-dim: rgba(0, 242, 234, 0.1);
            --accent: #ff0050;            
            --warning: #ffd700;
            --bg-deep: #030508;           
            --glass-panel: rgba(12, 16, 24, 0.85);
            --border: rgba(255, 255, 255, 0.1);
            --text-main: #eef2f6;
            --text-muted: #8899a6;
            --sidebar-w: 240px;
            --nav-h-mobile: 70px;
        }

        /* Light Mode Variables */
        body.light-mode {
            --primary: #007f7b; /* 深青色 */
            --primary-dim: rgba(0, 127, 123, 0.1);
            --accent: #d90040;
            --bg-deep: #f0f2f5;
            --glass-panel: rgba(255, 255, 255, 0.9);
            --border: rgba(0, 0, 0, 0.08);
            --text-main: #1a1d21;
            --text-muted: #5e656d;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-deep);
            color: var(--text-main);
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
            margin: 0; padding: 0;
            height: 100vh;
            overflow: hidden;
            display: flex;
            transition: background-color 0.3s, color 0.3s;
            /* 修复手机端滑动回弹的挤压感 */
            overscroll-behavior: none;
        }

        /* 修复 Light Mode 下背景不可见问题 */
        #canvas-bg {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0;
            background: radial-gradient(circle at 70% 30%, #0f1623 0%, #000000 100%);
            pointer-events: none;
            transition: opacity 0.3s;
        }
        body.light-mode #canvas-bg { opacity: 0.1; }

        /* --- Sidebar --- */
        .sidebar {
            width: var(--sidebar-w); background: var(--glass-panel);
            border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 25px 15px; z-index: 100; flex-shrink: 0;
            backdrop-filter: blur(15px);
        }
        .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 40px; padding: 0 10px; }
        .brand-logo {
            width: 36px; height: 36px; background: var(--primary);
            clip-path: polygon(20% 0%, 100% 0%, 80% 100%, 0% 100%);
            display: flex; align-items: center; justify-content: center;
            font-family: 'Orbitron'; font-weight: 900; color: #fff; font-size: 1.2rem;
            box-shadow: 0 0 15px var(--primary);
        }
        .brand-text { font-family: 'Orbitron'; font-size: 1.1rem; font-weight: 700; letter-spacing: 1px; color: var(--text-main); }

        .nav-menu { display: flex; flex-direction: column; gap: 5px; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 15px; border-radius: 6px;
            color: var(--text-muted); cursor: pointer; font-family: 'Rajdhani'; font-weight: 600; font-size: 1rem;
            transition: all 0.2s; border-left: 2px solid transparent;
        }
        .nav-item:hover { color: var(--text-main); background: rgba(125,125,125,0.05); }
        .nav-item.active { background: var(--primary-dim); color: var(--primary); border-left-color: var(--primary); }
        .nav-item i { width: 20px; text-align: center; }

        /* --- Main Content --- */
        .main-content { 
            flex-grow: 1; height: 100vh; overflow-y: auto; padding: 0; position: relative; z-index: 5;
            scroll-behavior: smooth;
            overscroll-behavior-y: contain; /* 仅在内容区滚动 */
        }
        .content-wrapper { 
            padding: 40px; max-width: 1400px; margin: 0 auto; 
            padding-bottom: 150px;
            animation: fadeIn 0.5s ease; 
        }

        /* Headers & Tools */
        .page-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 25px; flex-wrap: wrap; gap: 15px; }
        .header-left { display: flex; align-items: center; gap: 15px; }
        .header-icon-box { 
            width: 42px; height: 42px; background: rgba(125,125,125,0.05); border: 1px solid var(--border);
            border-radius: 8px; display: flex; align-items: center; justify-content: center; color: var(--primary);
            font-size: 1.2rem;
        }
        .page-title h2 { font-family: 'Orbitron'; font-size: 1.8rem; margin: 0; color: var(--text-main); letter-spacing: 1px; }
        .page-title p { color: var(--text-muted); margin: 4px 0 0 0; font-family: 'Rajdhani'; font-size: 0.9rem; }
        
        /* 搜索框修复：增加 z-index 确保可点击 */
        .search-box { position: relative; width: 280px; z-index: 10; }
        .search-input {
            width: 100%; background: var(--glass-panel); border: 1px solid var(--border);
            padding: 10px 15px 10px 38px; border-radius: 4px; color: var(--text-main); height: 38px;
            font-family: 'Inter'; font-size: 0.9rem; outline: none; transition: 0.3s;
        }
        .search-input:focus { border-color: var(--primary); background: var(--bg-deep); }
        .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 0.8rem; pointer-events: none; }

        /* Stats & Discovery */
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px; }
        .stat-card {
            background: var(--glass-panel); border: 1px solid var(--border); border-radius: 8px; padding: 15px 20px;
            display: flex; flex-direction: column; justify-content: center; backdrop-filter: blur(10px); transition: 0.2s;
        }
        .stat-label { font-family: 'Rajdhani'; color: var(--text-muted); font-size: 0.85rem; font-weight: 600; text-transform: uppercase; margin-bottom: 8px; display: flex; justify-content: space-between; }
        .stat-value { font-family: 'Orbitron'; color: var(--text-main); font-size: 1.4rem; font-weight: 600; }
        
        .discovery-section {
            background: var(--glass-panel); border: 1px solid var(--border); border-radius: 8px; padding: 25px; margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }
        .hero-search input {
            width: 100%; background: rgba(0,0,0,0.1); border: 1px solid var(--border);
            padding: 15px 20px 15px 50px; border-radius: 6px; color: var(--text-main); font-size: 1rem;
            outline: none; transition: 0.3s;
        }
        .hero-search i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--primary); }

        .tag-chips { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; }
        .tag-chip {
            padding: 6px 12px; background: rgba(125,125,125,0.05); border: 1px solid var(--border);
            border-radius: 20px; font-family: 'Rajdhani'; font-weight: 600; font-size: 0.85rem;
            color: var(--text-muted); cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px;
        }
        .tag-chip:hover { border-color: var(--primary); color: var(--text-main); background: var(--primary-dim); }

        /* Papers List */
        .section-header { 
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; 
            border-bottom: 1px solid var(--border); padding-bottom: 10px; margin-top: 20px;
        }
        .section-title { font-family: 'Rajdhani'; font-weight: 700; font-size: 1.1rem; color: var(--text-main); letter-spacing: 1px; display: flex; align-items: center; gap: 8px; }
        .live-dot { width: 8px; height: 8px; background: var(--accent); border-radius: 50%; box-shadow: 0 0 8px var(--accent); animation: blink 1.5s infinite; }

        .paper-card {
            background: var(--glass-panel); border: 1px solid var(--border); border-radius: 8px; padding: 20px; margin-bottom: 15px;
            transition: all 0.3s; position: relative; overflow: hidden;
        }
        .paper-card:hover { transform: translateX(5px); border-color: var(--primary); }
        
        .pc-header { display: flex; gap: 20px; align-items: flex-start; cursor: pointer; position: relative; z-index: 2; }
        .pc-score {
            width: 45px; height: 45px; border-radius: 6px; background: rgba(125,125,125,0.1); border: 1px solid var(--border);
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
            font-family: 'Orbitron'; font-weight: 700; font-size: 1.1rem; color: var(--text-muted);
        }
        .score-high { color: var(--accent); border-color: var(--accent); }
        .score-good { color: var(--primary); border-color: var(--primary); }

        .pc-content { flex-grow: 1; min-width: 0; }
        .pc-title { font-size: 1.05rem; font-weight: 600; color: var(--text-main); line-height: 1.4; margin-bottom: 4px; }
        /* 修复英文副标题显示逻辑 */
        .pc-trans { font-size: 0.9rem; color: var(--text-muted); margin-bottom: 8px; font-family: 'Inter', sans-serif; display: block; }
        .pc-meta { display: flex; gap: 10px; flex-wrap: wrap; font-size: 0.75rem; color: var(--text-muted); font-family: 'Rajdhani'; text-transform: uppercase; align-items: center; }
        .pc-tag { color: var(--primary); border: 1px solid var(--primary-dim); padding: 1px 6px; border-radius: 3px; font-weight: 600; }

        /* Bookmark 修复：增加 z-index，独立点击区域 */
        .bookmark-btn {
            padding: 8px; font-size: 1.2rem; cursor: pointer; position: relative; z-index: 10;
            transition: transform 0.2s;
        }
        .bookmark-btn:active { transform: scale(0.9); }

        .pc-details { display: none; margin-top: 20px; padding-top: 20px; border-top: 1px dashed var(--border); animation: fadeIn 0.3s; }
        .detail-grid { display: grid; grid-template-columns: 220px 1fr; gap: 30px; }
        .radar-wrapper { width: 100%; height: 200px; position: relative; }

        .verdict-box { background: var(--primary-dim); border-left: 2px solid var(--primary); padding: 15px; margin-bottom: 15px; border-radius: 0 4px 4px 0; }
        .verdict-label { font-family: 'Orbitron'; color: var(--primary); font-size: 0.8rem; margin-bottom: 10px; display: block; letter-spacing: 1px; font-weight: 700; }
        
        /* 核心修复：列表格式化样式 */
        .ai-text-content { 
            font-size: 0.95rem; line-height: 1.8; color: var(--text-main); 
            white-space: pre-line; /* 识别换行符 */
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
        }
        /* 增加列表项的缩进效果 */
        .ai-text-content ul { padding-left: 20px; margin: 5px 0; }

        .btn-action {
            display: inline-flex; align-items: center; gap: 6px; margin-top: 15px;
            padding: 8px 20px; border: 1px solid var(--primary); color: var(--primary);
            text-decoration: none; font-family: 'Rajdhani'; font-weight: 700; border-radius: 4px;
            font-size: 0.85rem; transition: 0.3s; text-transform: uppercase; letter-spacing: 1px;
        }
        .btn-action:hover { background: var(--primary); color: #fff; }

        /* Hunter & Scanner */
        .hunter-fab {
            position: fixed; bottom: 30px; right: 30px;
            width: 60px; height: 60px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid var(--primary); border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; z-index: 900;
            box-shadow: 0 0 20px var(--primary-dim);
            transition: all 0.3s; animation: pulse 3s infinite;
        }
        .hunter-fab i { font-size: 1.5rem; color: var(--primary); }
        .scanner-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(3, 5, 8, 0.98); z-index: 2000;
            display: none; align-items: center; justify-content: center; flex-direction: column;
        }
        .scanner-text { font-family: 'Orbitron'; color: var(--primary); font-size: 1.5rem; margin-top: 20px; }

        /* Mobile */
        .mobile-nav { display: none; }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-nav {
                display: flex; justify-content: space-around; align-items: center;
                position: fixed; bottom: 0; left: 0; width: 100%; height: var(--nav-h-mobile);
                background: var(--glass-panel); border-top: 1px solid var(--border); z-index: 1000;
                backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
                padding-bottom: env(safe-area-inset-bottom);
            }
            .mobile-nav-item { 
                display: flex; flex-direction: column; align-items: center; justify-content: center; 
                color: var(--text-muted); font-size: 0.7rem; width: 25%; height: 100%;
                gap: 4px; 
            }
            .mobile-nav-item.active { color: var(--primary); }
            .content-wrapper { padding: 15px; padding-bottom: 100px; }
            .page-header { flex-direction: column; align-items: flex-start; }
            .header-right { width: 100%; justify-content: space-between; }
            .search-box { width: 100%; }
            .detail-grid { grid-template-columns: 1fr; }
            .hunter-fab { bottom: 90px; right: 20px; width: 50px; height: 50px; }
            .stat-card { align-items: center; text-align: center; padding: 10px 5px; }
            .stat-value { font-size: 1.1rem; }
            .stat-label { font-size: 0.65rem; flex-direction: column; gap: 5px; }
        }

        @keyframes fadeIn { from{opacity:0;transform:translateY(10px);} to{opacity:1;transform:translateY(0);} }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 var(--primary-dim); } 70% { box-shadow: 0 0 0 15px transparent; } 100% { box-shadow: 0 0 0 0 transparent; } }
    </style>
</head>
<body class="">
    <canvas id="canvas-bg"></canvas>

    <!-- Sidebar -->
    <nav class="sidebar">
        <div class="brand">
            <div class="brand-logo">A</div>
            <div>
                <div class="brand-text">ALPHA HUNTER</div>
                <div style="font-size:0.6rem; color:var(--text-muted);">QUANT TERMINAL v15.0</div>
            </div>
        </div>
        <div class="nav-menu">
            <div class="nav-item active" onclick="router('dashboard')"><i class="fas fa-th-large"></i> <span data-i18n="nav_dash">Terminal</span></div>
            <div class="nav-item" onclick="router('papers')"><i class="fas fa-database"></i> <span data-i18n="nav_papers">Database</span></div>
            <div class="nav-item" onclick="router('bookmarks')"><i class="fas fa-bookmark"></i> <span data-i18n="nav_saved">Bookmarks</span></div>
            <div class="nav-item" onclick="router('settings')"><i class="fas fa-sliders-h"></i> <span data-i18n="nav_settings">System</span></div>
        </div>
    </nav>

    <main class="main-content">
        <div class="content-wrapper" id="view-container"></div>
    </main>

    <div class="mobile-nav">
        <div class="mobile-nav-item active" onclick="router('dashboard')"><i class="fas fa-th-large"></i><span>Dash</span></div>
        <div class="mobile-nav-item" onclick="router('papers')"><i class="fas fa-database"></i><span>Data</span></div>
        <div class="mobile-nav-item" onclick="router('bookmarks')"><i class="fas fa-bookmark"></i><span>Saved</span></div>
        <div class="mobile-nav-item" onclick="router('settings')"><i class="fas fa-sliders-h"></i><span>System</span></div>
    </div>

    <div class="hunter-fab" onclick="startHunting()"><i class="fas fa-crosshairs"></i></div>

    <div id="scanner-overlay" class="scanner-overlay">
        <i class="fas fa-crosshairs fa-spin" style="font-size:3rem; color:var(--primary)"></i>
        <div class="scanner-text" data-i18n="scanning">SEARCHING...</div>
    </div>

    <script>
        // --- Particle Background ---
        const canvas=document.getElementById('canvas-bg'),ctx=canvas.getContext('2d');
        let w,h,particles=[]; 
        function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
        window.addEventListener('resize',resize);resize();
        class P{constructor(){this.reset()}reset(){this.x=Math.random()*w;this.y=Math.random()*h;this.s=Math.random()*2;this.a=Math.random()*0.5;this.v=(Math.random()-0.5)*0.5}update(){this.y-=0.2;if(this.y<0)this.reset()}draw(){ctx.fillStyle=`rgba(0,242,234,${this.a})`;ctx.beginPath();ctx.arc(this.x,this.y,this.s,0,6.28);ctx.fill()}}
        for(let i=0;i<60;i++)particles.push(new P());
        function animate(){ctx.clearRect(0,0,w,h);particles.forEach(p=>{p.update();p.draw()});requestAnimationFrame(animate)}
        animate();

        // --- State ---
        let appState = {
            lang: localStorage.getItem('ah_lang') || 'cn', // 默认中文
            theme: localStorage.getItem('ah_theme') || 'dark',
            papers: [],
            bookmarks: JSON.parse(localStorage.getItem('ah_bookmarks') || '[]'),
            currentView: 'dashboard'
        };

        // Apply Theme on Load
        if(appState.theme === 'light') document.body.classList.add('light-mode');

        const i18n = {
            en: {
                nav_dash: "Terminal", nav_papers: "Database", nav_saved: "Bookmarks", nav_settings: "System",
                dash_title: "QUANT TERMINAL", dash_sub: "Quick Intelligence Access",
                stat_sent: "Sentiment", stat_vol: "Volatility", stat_gas: "Gas Fee",
                latest_feed: "LATEST PAPERS", discovery: "KNOWLEDGE BASE", search_ph: "Search keywords...",
                verdict: "DEEPSEEK V3 VERDICT", summary: "CORE INSIGHTS", read: "SOURCE FILE",
                scanning: "SEARCHING ALPHA...", hunter_mode: "HUNTER MODE", total_papers: "INDEXED",
                theme_title: "Display Mode", lang_title: "Language"
            },
            cn: {
                nav_dash: "量化终端", nav_papers: "情报数据库", nav_saved: "收藏夹", nav_settings: "系统设置",
                dash_title: "量化投研终端", dash_sub: "碎片化时间高效研读",
                stat_sent: "情绪指数", stat_vol: "波动率", stat_gas: "Gas费",
                latest_feed: "最新入库", discovery: "核心情报检索", search_ph: "输入关键词 (如: 高频, 套利)...",
                verdict: "DEEPSEEK V3 锐评", summary: "核心内容提炼", read: "阅读原文",
                scanning: "正在扫描 ALPHA 信号...", hunter_mode: "狩猎模式", total_papers: "已收录",
                theme_title: "显示模式", lang_title: "界面语言"
            }
        };

        async function init(){
            try {
                // 增加时间戳防止缓存，确保加载最新数据
                const r = await fetch('papers.json?t=' + new Date().getTime());
                if(!r.ok) throw new Error("No JSON");
                appState.papers = await r.json();
            } catch(e) {
                console.log("No data found, waiting for crawler.");
                appState.papers = [];
            }
            appState.papers.sort((a,b)=>new Date(b.published)-new Date(a.published));
            router('dashboard');
        }

        function router(view){
            appState.currentView = view;
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active');
                if(el.innerHTML.includes(i18n[appState.lang][`nav_${view}`=='nav_dashboard'?'nav_dash':`nav_${view}`])) el.classList.add('active');
            });
            document.querySelectorAll('.mobile-nav-item').forEach(el => {
                el.classList.remove('active');
                if(el.getAttribute('onclick').includes(view)) el.classList.add('active');
            });

            const c = document.getElementById('view-container');
            c.innerHTML = '';
            
            if(view === 'dashboard') renderDashboard(c);
            if(view === 'papers') renderList(c, appState.papers);
            if(view === 'bookmarks') renderList(c, appState.papers.filter(p=>appState.bookmarks.includes(p.id)));
            if(view === 'settings') renderSettings(c);
            
            updateText();
        }

        function renderDashboard(c){
            const t = i18n[appState.lang];
            const recent = appState.papers.slice(0, 5);
            c.innerHTML = `
                <div class="page-header">
                    <div class="header-left">
                        <div class="header-icon-box"><i class="fas fa-satellite-dish"></i></div>
                        <div class="page-title"><h2>${t.dash_title}</h2><p>${t.dash_sub}</p></div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-label"><span>${t.stat_sent}</span><i class="fas fa-smile" style="color:#00f2ea"></i></div><div class="stat-value">72.4</div></div>
                    <div class="stat-card"><div class="stat-label"><span>${t.stat_vol}</span><i class="fas fa-bolt" style="color:#ff0050"></i></div><div class="stat-value">18.9</div></div>
                    <div class="stat-card"><div class="stat-label"><span>${t.stat_gas}</span><i class="fas fa-gas-pump" style="color:#ffd700"></i></div><div class="stat-value">15</div></div>
                </div>
                <div class="discovery-section">
                    <div class="stat-label" style="margin-bottom:15px"><span>${t.discovery}</span><span>${appState.papers.length} ${t.total_papers}</span></div>
                    <div class="hero-search">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="${t.search_ph}" onkeyup="if(event.key==='Enter')handleGlobalSearch(this.value)">
                    </div>
                    <div class="tag-chips">
                        <div class="tag-chip" onclick="handleGlobalSearch('Arbitrage')">Arbitrage</div>
                        <div class="tag-chip" onclick="handleGlobalSearch('LLM')">LLM</div>
                        <div class="tag-chip" onclick="handleGlobalSearch('High-Freq')">High-Freq</div>
                        <div class="tag-chip" onclick="handleGlobalSearch('Crypto')">Crypto</div>
                    </div>
                </div>
                <div class="section-header"><div class="section-title"><div class="live-dot"></div> ${t.latest_feed}</div></div>
                <div id="dash-list"></div>
            `;
            renderCards(recent, document.getElementById('dash-list'));
        }

        function renderList(c, papers, headerContent = null){
            const t = i18n[appState.lang];
            c.innerHTML = (headerContent || `
                <div class="page-header">
                    <div class="header-left"><div class="header-icon-box"><i class="fas fa-database"></i></div><div class="page-title"><h2>DATABASE</h2></div></div>
                    <div class="header-right"><div class="search-box"><i class="fas fa-search search-icon"></i><input type="text" class="search-input" placeholder="Search..." onkeyup="handleSearch(this)"></div></div>
                </div>
            `) + `<div id="list-root"></div>`;
            renderCards(papers, document.getElementById('list-root'));
        }

        function renderSettings(c){
            const t = i18n[appState.lang];
            const isEn = appState.lang === 'en';
            const isDark = appState.theme === 'dark';
            c.innerHTML = `
                <div class="page-header"><div class="page-title"><h2>SETTINGS</h2></div></div>
                <div style="background:var(--glass-panel);border:1px solid var(--border);border-radius:8px;padding:20px;max-width:600px;margin:0 auto">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:20px;border-bottom:1px solid var(--border)">
                        <div><h4 style="margin:0;color:var(--text-main)">${t.lang_title}</h4></div>
                        <div style="display:flex;background:rgba(0,0,0,0.2);border:1px solid var(--border);border-radius:4px;padding:2px">
                            <div onclick="setLang('en')" style="padding:4px 12px;cursor:pointer;font-family:'Rajdhani';font-weight:600;color:${isEn?'#fff':varTextMuted()};background:${isEn?'var(--primary)':'transparent'}">EN</div>
                            <div onclick="setLang('cn')" style="padding:4px 12px;cursor:pointer;font-family:'Rajdhani';font-weight:600;color:${!isEn?'#fff':varTextMuted()};background:${!isEn?'var(--primary)':'transparent'}">CN</div>
                        </div>
                    </div>
                    <div style="display:flex;justify-content:space-between;align-items:center;">
                        <div><h4 style="margin:0;color:var(--text-main)">${t.theme_title}</h4></div>
                        <div style="display:flex;background:rgba(0,0,0,0.2);border:1px solid var(--border);border-radius:4px;padding:2px">
                            <div onclick="setTheme('dark')" style="padding:4px 12px;cursor:pointer;font-weight:600;color:${isDark?'#fff':varTextMuted()};background:${isDark?'var(--primary)':'transparent'}"><i class="fas fa-moon"></i></div>
                            <div onclick="setTheme('light')" style="padding:4px 12px;cursor:pointer;font-weight:600;color:${!isDark?'#fff':varTextMuted()};background:${!isDark?'var(--primary)':'transparent'}"><i class="fas fa-sun"></i></div>
                        </div>
                    </div>
                </div>`;
        }

        function renderCards(papers, wrapper){
            if(!papers || papers.length === 0){ wrapper.innerHTML = '<div style="text-align:center;color:var(--text-muted);padding:20px">NO DATA</div>'; return; }
            const t = i18n[appState.lang];
            const isCn = appState.lang === 'cn';
            
            papers.forEach((p, idx) => {
                const card = document.createElement('div'); card.className = 'paper-card';
                const rid = `r-${Math.random().toString(36).substr(2)}`;
                const isMark = appState.bookmarks.includes(p.id);
                const score = parseFloat(p.ai_score);
                const sCls = score >= 8 ? 'score-high' : (score >= 6 ? 'score-good' : '');

                // --- 核心修复：标题和语言逻辑 ---
                // 1. 中文模式：主标题=中文(没有就显示英文)，副标题=英文原名
                // 2. 英文模式：主标题=英文，副标题=不显示
                let mainTitle = p.title;
                let subTitle = "";
                
                if (isCn) {
                    mainTitle = p.translated_title || p.title;
                    if (mainTitle !== p.title) {
                        subTitle = p.title;
                    }
                }

                // 字段回退保护
                const verdict = isCn ? (p.verdict_cn || "暂无锐评") : (p.verdict_en || "No verdict.");
                const summary = isCn ? (p.summary_cn || "分析中...") : (p.summary_en || "Pending analysis...");

                card.innerHTML = `
                    <div class="pc-header" onclick="toggle('${rid}', ${score}, this)">
                        <div class="pc-score ${sCls}">${p.ai_score}</div>
                        <div class="pc-content">
                            <div class="pc-title">${mainTitle}</div>
                            ${subTitle ? `<div class="pc-trans">${subTitle}</div>` : ''}
                            <div class="pc-meta"><span class="pc-tag">${p.ai_strategy}</span><span>${p.published}</span></div>
                        </div>
                        <div class="bookmark-btn" onclick="mark(event,'${p.id}')">
                            <i class="${isMark?'fas':'far'} fa-bookmark" style="color:${isMark?'#ffd700':'var(--text-muted)'}"></i>
                        </div>
                    </div>
                    <div class="pc-details">
                        <div class="detail-grid">
                            <div class="radar-wrapper"><canvas id="${rid}"></canvas></div>
                            <div>
                                <div class="verdict-box">
                                    <span class="verdict-label">${t.verdict}</span>
                                    <div class="ai-text-content">${verdict}</div>
                                </div>
                                <div style="margin-bottom:15px">
                                    <strong style="color:var(--text-muted);font-size:0.7rem;display:block;margin-bottom:5px;font-family:'Orbitron'">${t.summary}</strong>
                                    <div class="ai-text-content">${summary}</div>
                                </div>
                                <a href="${p.pdf_url}" target="_blank" class="btn-action">${t.read} <i class="fas fa-external-link-alt"></i></a>
                            </div>
                        </div>
                    </div>
                `;
                wrapper.appendChild(card);
            });
        }

        // --- Logic & Events ---
        function toggle(rid, score, el){
            const d = el.nextElementSibling; const open = d.style.display === 'block';
            d.style.display = open ? 'none' : 'block';
            if(!open) setTimeout(() => { drawRadar(rid, score); }, 50);
        }

        function mark(e, id){ 
            e.stopPropagation(); // 核心修复：阻止点击穿透
            const i=appState.bookmarks.indexOf(id); 
            i>-1 ? appState.bookmarks.splice(i,1) : appState.bookmarks.push(id); 
            localStorage.setItem('ah_bookmarks',JSON.stringify(appState.bookmarks)); 
            router(appState.currentView); 
        }

        function setLang(l){ appState.lang=l; localStorage.setItem('ah_lang',l); router(appState.currentView); }
        
        function setTheme(thm){
            appState.theme = thm;
            localStorage.setItem('ah_theme', thm);
            if(thm === 'light') document.body.classList.add('light-mode');
            else document.body.classList.remove('light-mode');
            renderSettings(document.getElementById('view-container')); // Re-render settings to update active state
        }

        function updateText(){ 
            const t=i18n[appState.lang]; 
            document.querySelectorAll('[data-i18n]').forEach(el=>{ if(t[el.dataset.i18n]) el.innerText=t[el.dataset.i18n]; }); 
        }

        function handleSearch(inp){ 
            const k=inp.value.toLowerCase(); 
            const f=appState.papers.filter(p=>(p.title+p.summary_en+p.translated_title).toLowerCase().includes(k)); 
            renderCards(f, document.getElementById('list-root')); 
        }

        function handleGlobalSearch(term){
            appState.currentView='papers';
            router('papers');
            setTimeout(()=>{
                const inp=document.querySelector('.search-input');
                if(inp){ inp.value=term; handleSearch(inp); }
            },100);
        }

        function startHunting(){
            if(appState.papers.length===0) return;
            const overlay=document.getElementById('scanner-overlay');
            overlay.style.display='flex';
            setTimeout(()=>{
                const target=appState.papers[Math.floor(Math.random()*appState.papers.length)];
                appState.currentView='papers';
                document.querySelectorAll('.nav-item').forEach(el=>el.classList.remove('active'));
                const c=document.getElementById('view-container');
                c.innerHTML='';
                const header=`<div style="text-align:center;margin-bottom:30px;animation:fadeIn 1s"><div style="color:var(--primary);font-family:'Orbitron';letter-spacing:3px;font-size:1.2rem;margin-bottom:5px"><i class="fas fa-crosshairs"></i> ${i18n[appState.lang].hunter_mode}</div></div>`;
                renderList(c, [target], header);
                const head=document.getElementById('list-root').querySelector('.pc-header');
                if(head) head.click();
                overlay.style.display='none';
            },1500);
        }

        function drawRadar(id, score){
            const cvs=document.getElementById(id); if(!cvs) return;
            if(Chart.getChart(id)) Chart.getChart(id).destroy();
            const colors = appState.theme === 'dark' ? { grid:'rgba(255,255,255,0.1)', text:'#889' } : { grid:'rgba(0,0,0,0.1)', text:'#555' };
            new Chart(cvs.getContext('2d'), {
                type:'radar',
                data:{
                    labels: i18n[appState.lang].radar || ['Innovation','Practicality','Risk','Profit','Clarity'],
                    datasets:[{data:[score, Math.min(10,score*0.9+1), Math.min(10,score*1.1-1), Math.min(10,score*0.8+2), Math.min(10,score)], backgroundColor:'rgba(0,242,234,0.2)', borderColor: getComputedStyle(document.body).getPropertyValue('--primary'), borderWidth:2, pointBackgroundColor:'#fff', pointRadius:3}]
                },
                options:{
                    responsive:true, maintainAspectRatio:false,
                    scales:{r:{beginAtZero:true, max:10, grid:{color:colors.grid}, pointLabels:{color:colors.text, font:{size:11}}, ticks:{display:false}}},
                    plugins:{legend:{display:false}}
                }
            });
        }

        function varTextMuted() { return getComputedStyle(document.body).getPropertyValue('--text-muted'); }

        init();
    </script>
</body>
</html>
